<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <base href="../../static/" th:href="@{/}">
    <meta charset="UTF-8">
    <title>categoryManagement</title>
    <script src="js/header.js"></script>
    <link href="plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet"/>
    <script src="js/footer.js"></script>
    <script src="plugins/bootstrap-table/bootstrap-table.min.js"></script>
</head>
<body>




<div id="addContainer" class="modal" tabindex="-1">
    <div id="addMessageContainer" style="width: 20%;margin-top: 0.5%;position: fixed;z-index: 1;margin-left: 40%">
        <!--        <div class="alert alert-danger fade" role="alert" style="font-size: 15px">-->
        <!--            Server error-->
        <!--            <button type="button" class="close" data-dismiss="alert" aria-label="Close">-->
        <!--                <span aria-hidden="true">&times;</span>-->
        <!--            </button>-->
        <!--        </div>-->
    </div>
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">New Category</h5>
            </div>
            <div class="modal-body">
                <div>
                    <form id="addForm">
                        <input id="addCategoryInput" class="form-control" type="text" name="categoryName" placeholder="Input new category" oninput="$(this).siblings('div').hide();"/>
                        <div id="categoryFeedback" class="invalid-feedback">Category cannot be empty</div>
                    </form>
                </div>
            </div>
            <div class="modal-footer" style="width: 100%">
                <button type="button" class="btn btn-secondary addBtn" onclick="$('#addContainer').modal('hide')">Close</button>
                <button id="addBtn" type="button" class="btn btn-primary addBtn" onclick="addNewCategory(this)">Add</button>
            </div>
        </div>
    </div>
</div>



<div class="container" style="margin-top: 5%">
<!--    <div id="toolbar">-->
<!--        <div class="row">-->
<!--            <div class="col-8">123</div>-->
<!--            <div class="col-4">123</div>-->
<!--        </div>-->
<!--    </div>-->

    <div id="toolbar">
        <div class="btns">
            <a class="btn-primary btn" onclick="$('#addContainer').modal({keyboard:true,focus:true,show:true})">Add Category</a>
        </div>
<!--        <div class="col-3">-->
<!--            <input class="form-control" type="text" id="searchText" placeholder="search here"/>-->
<!--        </div>-->
    </div>
    <table id="table" data-cache="false">

    </table>
</div>
<script>
    $(function (){
        $('#table').bootstrapTable({
            search:true,
            toolbar:"#toolbar",
            url:"category/query",
            columns: [{
                field: 'id',
                title: 'Category ID'
            }, {
                field: 'categoryName',
                title: 'name'
            },
                {
                    field: "operate",
                    title:"operation",
                    clickToSelect: false,
                    align:'center',
                    events: window.operateEvents,
                    formatter: operateFormatter
                }
            ]
        })
    })


    function operateFormatter(){
        return ["<a href='javascript:void(0)' title='delete'><i>remove</i></a>","<a href='javascript:void(0)' title='delete'><i>edit</i></a>"].join("<div></div>");
    }

    function addNewCategory(btn){

        $.ajax(
            {
                type:"post",
                url:"category/add",
                data:$("#addForm").serialize(),
                beforeSend:function (){
                    let category = $("#addCategoryInput");
                    let val = category.val();
                    let canSend = true;
                    if (val==null||val==undefined||val.length==0){
                        $(btn).siblings("div").show();
                        canSend = false;
                    }
                    if (!canSend){
                        $("#categoryFeedback").show();
                        return canSend;
                    }
                    let btns = $(".addBtn");
                    btns[0].disabled = true;
                    btns[1].disabled = true;
                    enableLoadingVideo($("#addBtn"));
                    return true;
                },
                success:function (result){

                    let btns = $(".addBtn");
                    btns[0].disabled = false;
                    btns[1].disabled = false;
                    disableLoadingVideo($("#addBtn"),"Add");
                    if (result==null||result==undefined){
                        alertUtil.message("Add failed","danger",$("#addMessageContainer"))
                        return;
                    }
                    if (result.code!=1){
                        alertUtil.message(result.message,"warning",$("#addMessageContainer"));
                        return;
                    }
                    alertUtil.message(result.message,"info",$("#addMessageContainer"));
                    $("#addCategoryInput")[0].value = "";
                },
                error:function (){
                    let btns = $(".addBtn");
                    btns[0].disabled = false;
                    btns[1].disabled = false;
                    disableLoadingVideo($("#addBtn"),"Add");
                    alertUtil.message("Add failed","danger",$("#addMessageContainer"))
                }
            }
        )
    }


</script>
</body>
</html>